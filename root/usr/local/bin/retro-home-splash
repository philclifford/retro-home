#!/usr/bin/env bash
# https://yingtongli.me/blog/2016/12/21/splash.html
# https://stackoverflow.com/questions/46143476/why-does-fbi-not-show-splash-image-during-system-startup
# https://blog.fraggod.net/2015/11/28/raspberry-pi-early-boot-splash-logo-screen.html
# https://shop.sb-components.co.uk/blogs/posts/customising-splash-screen-on-your-raspberry-pi

# Make sure the fontconfig cache is ready; fbi will fail if not.
# Rebuild the font-cache if it is incomplete
if ! fc-list | grep -q mplus; then
    fc-cache -frsv
fi

echo "Waiting for /dev/fb0"
while [ ! -e /dev/fb0 ]; do
  echo -n '.'
  sleep 0.1
done
echo -e "\nFound /dev/fb0"

/usr/bin/fbi --vt 3 --device /dev/fb0 --noverbose --autozoom /usr/share/backgrounds/Retro-Home-Wallpaper-blank.png

echo "Waiting for xinit"
until pidof -q xinit; do
  echo -n '.'
  sleep 1
done
echo -e "\nFound xinit"
